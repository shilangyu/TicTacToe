(()=>{"use strict";var t={336:function(t,e,n){var r=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0});var i=n(949),o=function(){function t(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r={AI:"○",player:"×"}),this.width=t,this.height=e,this.signs=r,this.tiles=new Array(e).fill(null).map((function(){return new Array(t).fill(null)})),this.turn=n}return Object.defineProperty(t.prototype,"full",{get:function(){return this.tiles.every((function(t){return t.every((function(t){return null!==t}))}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stringified",{get:function(){return this.tiles.map((function(t){return t.map((function(t){return t}))})).reduce((function(t,e){return r(r([],t),e)}),[]).map(String).join("")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotations",{get:function(){var e=new t(3,3);e.tiles=this.tiles.map((function(t){return t.map((function(t){return t}))}));for(var n=this.tiles.map((function(t){return t.map((function(t){return t}))})),r=[],o=0;o<4;o++)e.tiles=i.rotate(n,o),r.push(e.stringified);return r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mirrors",{get:function(){var e=new t(3,3);e.tiles=this.tiles.map((function(t){return t.map((function(t){return t}))}));for(var n=this.tiles.map((function(t){return t.map((function(t){return t}))})),r=[],o=0;o<4;o++)e.tiles=i.mirror(n,o),r.push(e.stringified);return r},enumerable:!1,configurable:!0}),t.prototype.playerMove=function(t,e){return this.move(t,e,0),0===this.win()},t.prototype.aiMove=function(t,e){return this.move(t,e,1),1===this.win()},t.prototype.move=function(t,e,n){this.tiles[t][e]=n,this.toggleTurn()},t.prototype.toggleTurn=function(){null!==this.win()||this.full?this.turn=null:this.turn=this.turn?0:1},t.prototype.win=function(){for(var t,e=!0,n=0,r=this.tiles;n<r.length;n++){var i=r[n];if(e=!0,null!==(t=i[0])){for(var o=0,u=i;o<u.length;o++)if(u[o]!==t){e=!1;break}if(e)return t}}for(var a=0;a<this.tiles.length;a++)if(e=!0,null!==(t=this.tiles[0][a])){for(var s=0;s<this.tiles[a].length;s++)if(this.tiles[s][a]!==t){e=!1;break}if(e)return t}if(e=!0,null!==(t=this.tiles[0][0])){for(a=0;a<this.tiles.length;a++)if(this.tiles[a][a]!==t){e=!1;break}if(e)return t}if(e=!0,null!==(t=this.tiles[0][2])){for(a=0;a<this.tiles.length;a++)if(this.tiles[a][2-a]!==t){e=!1;break}if(e)return t}return null},t}();e.default=o},102:function(t,e,n){var r=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0});var i=n(949),o=function(){function t(){this.brain={}}return t.prototype.mappedDecisions=function(t,e){for(var n=0,o=0,u=r(r([],t),e);o<u.length;o++){var a=u[o];if(a in this.brain)return this.brain[a].map((function(t){var e=i.mapxy(t.x,t.y,n%4,n<4?"rotation":"mirror");return{x:e[0],y:e[1],fitness:t.fitness}}));n++}return[]},t.prototype.decide=function(t,e){var n=this.mappedDecisions(t,e);return n.length?n[Math.floor(Math.random()*n.length)]:(this.createMoves(t[0]),this.decide(t,e))},t.prototype.createMoves=function(t){this.brain[t]=[];var e=this.brain[t],n=t.replace(/[10]/g,"    ");if(n.includes("null"))do{var r=n.lastIndexOf("null")/4;e.push({x:Math.floor(r/3),y:r%3,fitness:100}),n=n.replace(/null( *)$/,"    $1")}while(n.includes("null"))},t}();e.default=o},949:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.unmapxy=e.mapxy=e.mirror=e.rotate=void 0,e.rotate=function(t,n){return t.map((function(t){return t.map((function(t){return t}))})).map((function(r,i){return r.map((function(r,o){var u=e.mapxy(i,o,n,"rotation"),a=u[0],s=u[1];return t[a][s]}))}))},e.mirror=function(t,e){var n,r=t.map((function(t){return t.map((function(t){return t}))}));switch(e){case 0:n=function(e,n){return r[t.length-n-1][t[e].length-e-1]};break;case 1:n=function(t,e){return r[e][t]};break;case 2:n=function(e,n){return r[e][t[e].length-n-1]};break;case 3:n=function(e,n){return r[t.length-e-1][n]}}return t.map((function(t,e){return t.map((function(t,r){return n(e,r)}))}))},e.mapxy=function(t,e,n,r){if("rotation"===r){t-=1,e-=1;var i=Math.PI/2*n,o=Math.cos(i),u=Math.sin(i);return[Math.round(t*o-e*u)+1,Math.round(t*u+e*o)+1]}switch(n){case 0:return[2-e,2-t];case 1:return[e,t];case 2:return[t,2-e];case 3:return[2-t,e]}return[1]},e.unmapxy=function(t,n,r,i){return"rotation"===i&&(r=4-r),e.mapxy(t,n,r,i)}},511:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function u(t){try{s(r.next(t))}catch(t){o(t)}}function a(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,a)}s((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!((i=(i=u.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(t,u)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u,a=o(n(336)),s=o(n(102)),l={scale:150,background:"#9198a3",strokes:"#ffffff",msg:document.querySelector("#msg"),restart:document.querySelector("#restart"),canvas:{ref:document.querySelector("canvas"),size:{x:450,y:450},ctx:document.querySelector("canvas").getContext("2d")},starting:function(){for(var t=Array.from(document.querySelectorAll("input[name=starting]")),e=0,n=t;e<n.length;e++)n[e].addEventListener("change",h);return function(){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.checked)return r.value}return"player"}}(),fps:60},c=new s.default;function f(t){l.msg.innerHTML=0===t?"You won":1===t?"AI won":"Draw"}function h(){if(u=new a.default(3,3,"AI"===l.starting()?1:0),"AI"===l.starting()){var t=c.decide(u.rotations,u.mirrors),e=t.x,n=t.y;u.aiMove(e,n)}l.msg.innerHTML=""}!function(){r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return h(),t=c,[4,fetch("./decisions.json")];case 1:return[4,e.sent().json()];case 2:return t.brain=e.sent(),l.canvas.ref.width=l.canvas.size.x,l.canvas.ref.height=l.canvas.size.y,l.canvas.ctx.textAlign="center",l.canvas.ctx.textBaseline="middle",l.canvas.ref.addEventListener("click",(function(t){var e=t.offsetX,n=t.offsetY,r=t.target,i=r.clientHeight,o=[e/(r.clientWidth/u.width),n/(i/u.height)].map((function(t){return Math.floor(t)}));if(0===u.turn&&null===u.tiles[o[1]][o[0]]){var a=u.playerMove(o[1],o[0]);if(a?f(0):u.full&&f(null),!a){var s=c.decide(u.rotations,u.mirrors),l=s.x,h=s.y;u.aiMove(l,h)?f(1):u.full&&f(null)}}})),l.restart.addEventListener("click",h),[2]}}))}))}(),setInterval((function(){var t=l.scale,e=l.canvas,n=e.size,r=e.ref,i=e.ctx;i.fillStyle=l.background,i.fillRect(0,0,r.width,r.height),u.tiles.forEach((function(e,r){return e.forEach((function(e,o){var a=null===e?"":0===e?u.signs.player:u.signs.AI;i.fillStyle=l.strokes,i.font=t+"px sans-serif",i.fillText(a,t*(o+.5),t*(r+.5)),i.lineWidth=l.scale/10,i.strokeStyle=l.strokes,i.beginPath(),i.moveTo(t*o,0),i.lineTo(t*o,n.y),i.stroke(),i.moveTo(0,t*r),i.lineTo(n.x,t*r),i.stroke()}))}))}),1e3/l.fps)}},e={};!function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}(511)})();