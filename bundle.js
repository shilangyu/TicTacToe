(()=>{"use strict";var t={243(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{s(n.next(t))}catch(t){o(t)}}function u(t){try{s(n.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=u(0),a.throw=u(1),a.return=u(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(s){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&u[0]?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,n=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){o.label=u[1];break}if(6===u[0]&&o.label<i[1]){o.label=i[1],i=u;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(u);break}i[2]&&o.ops.pop(),o.trys.pop();continue}u=e.call(t,o)}catch(t){u=[6,t],n=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a,u=o(r(348)),s=o(r(532)),l={scale:150,background:"#9198a3",strokes:"#ffffff",msg:document.querySelector("#msg"),restart:document.querySelector("#restart"),canvas:{ref:document.querySelector("canvas"),size:{x:450,y:450},ctx:document.querySelector("canvas").getContext("2d")},starting:function(){for(var t=Array.from(document.querySelectorAll("input[name=starting]")),e=0,r=t;e<r.length;e++)r[e].addEventListener("change",h);return function(){for(var e=0,r=t;e<r.length;e++){var n=r[e];if(n.checked)return n.value}return"player"}}(),fps:60},c=new s.default;function f(t){l.msg.innerHTML=0===t?"You won":1===t?"AI won":"Draw"}function h(){if(a=new u.default(3,3,"AI"===l.starting()?1:0),"AI"===l.starting()){var t=c.decide(a.rotations,a.mirrors),e=t.x,r=t.y;a.aiMove(e,r)}l.msg.innerHTML=""}!function(){n(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return h(),t=c,[4,fetch("./decisions.json")];case 1:return[4,e.sent().json()];case 2:return t.brain=e.sent(),l.canvas.ref.width=l.canvas.size.x,l.canvas.ref.height=l.canvas.size.y,l.canvas.ctx.textAlign="center",l.canvas.ctx.textBaseline="middle",l.canvas.ref.addEventListener("click",(function(t){var e=t.offsetX,r=t.offsetY,n=t.target,i=n.clientHeight,o=[e/(n.clientWidth/a.width),r/(i/a.height)].map((function(t){return Math.floor(t)}));if(0===a.turn&&null===a.tiles[o[1]][o[0]]){var u=a.playerMove(o[1],o[0]);if(u?f(0):a.full&&f(null),!u){var s=c.decide(a.rotations,a.mirrors),l=s.x,h=s.y;a.aiMove(l,h)?f(1):a.full&&f(null)}}})),l.restart.addEventListener("click",h),[2]}}))}))}(),setInterval((function(){var t=l.scale,e=l.canvas,r=e.size,n=e.ref,i=e.ctx;i.fillStyle=l.background,i.fillRect(0,0,n.width,n.height),a.tiles.forEach((function(e,n){return e.forEach((function(e,o){var u=null===e?"":0===e?a.signs.player:a.signs.AI;i.fillStyle=l.strokes,i.font="".concat(t,"px sans-serif"),i.fillText(u,t*(o+.5),t*(n+.5)),i.lineWidth=l.scale/10,i.strokeStyle=l.strokes,i.beginPath(),i.moveTo(t*o,0),i.lineTo(t*o,r.y),i.stroke(),i.moveTo(0,t*n),i.lineTo(r.x,t*n),i.stroke()}))}))}),1e3/l.fps)},306(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.unmapxy=e.mapxy=e.mirror=e.rotate=void 0,e.rotate=function(t,r){return t.map((function(t){return t.map((function(t){return t}))})).map((function(n,i){return n.map((function(n,o){var a=(0,e.mapxy)(i,o,r,"rotation"),u=a[0],s=a[1];return t[u][s]}))}))},e.mirror=function(t,e){var r,n=t.map((function(t){return t.map((function(t){return t}))}));switch(e){case 0:r=function(e,r){return n[t.length-r-1][t[e].length-e-1]};break;case 1:r=function(t,e){return n[e][t]};break;case 2:r=function(e,r){return n[e][t[e].length-r-1]};break;case 3:r=function(e,r){return n[t.length-e-1][r]}}return t.map((function(t,e){return t.map((function(t,n){return r(e,n)}))}))},e.mapxy=function(t,e,r,n){if("rotation"===n){t-=1,e-=1;var i=Math.PI/2*r,o=Math.cos(i),a=Math.sin(i);return[Math.round(t*o-e*a)+1,Math.round(t*a+e*o)+1]}switch(r){case 0:return[2-e,2-t];case 1:return[e,t];case 2:return[t,2-e];case 3:return[2-t,e]}return[1]},e.unmapxy=function(t,r,n,i){return"rotation"===i&&(n=4-n),(0,e.mapxy)(t,r,n,i)}},348(t,e,r){var n=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0});var i=r(306),o=function(){function t(t,e,r,n){void 0===r&&(r=0),void 0===n&&(n={AI:"○",player:"×"}),this.width=t,this.height=e,this.signs=n,this.tiles=new Array(e).fill(null).map((function(){return new Array(t).fill(null)})),this.turn=r}return Object.defineProperty(t.prototype,"full",{get:function(){return this.tiles.every((function(t){return t.every((function(t){return null!==t}))}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stringified",{get:function(){return this.tiles.map((function(t){return t.map((function(t){return t}))})).reduce((function(t,e){return n(n([],t,!0),e,!0)}),[]).map(String).join("")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotations",{get:function(){var e=new t(3,3);e.tiles=this.tiles.map((function(t){return t.map((function(t){return t}))}));for(var r=this.tiles.map((function(t){return t.map((function(t){return t}))})),n=[],o=0;o<4;o++)e.tiles=(0,i.rotate)(r,o),n.push(e.stringified);return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mirrors",{get:function(){var e=new t(3,3);e.tiles=this.tiles.map((function(t){return t.map((function(t){return t}))}));for(var r=this.tiles.map((function(t){return t.map((function(t){return t}))})),n=[],o=0;o<4;o++)e.tiles=(0,i.mirror)(r,o),n.push(e.stringified);return n},enumerable:!1,configurable:!0}),t.prototype.playerMove=function(t,e){return this.move(t,e,0),0===this.win()},t.prototype.aiMove=function(t,e){return this.move(t,e,1),1===this.win()},t.prototype.move=function(t,e,r){this.tiles[t][e]=r,this.toggleTurn()},t.prototype.toggleTurn=function(){null!==this.win()||this.full?this.turn=null:this.turn=this.turn?0:1},t.prototype.win=function(){for(var t,e=!0,r=0,n=this.tiles;r<n.length;r++){var i=n[r];if(e=!0,null!==(t=i[0])){for(var o=0,a=i;o<a.length;o++)if(a[o]!==t){e=!1;break}if(e)return t}}for(var u=0;u<this.tiles.length;u++)if(e=!0,null!==(t=this.tiles[0][u])){for(var s=0;s<this.tiles[u].length;s++)if(this.tiles[s][u]!==t){e=!1;break}if(e)return t}if(e=!0,null!==(t=this.tiles[0][0])){for(u=0;u<this.tiles.length;u++)if(this.tiles[u][u]!==t){e=!1;break}if(e)return t}if(e=!0,null!==(t=this.tiles[0][2])){for(u=0;u<this.tiles.length;u++)if(this.tiles[u][2-u]!==t){e=!1;break}if(e)return t}return null},t}();e.default=o},532(t,e,r){var n=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0});var i=r(306),o=function(){function t(){this.brain={}}return t.prototype.mappedDecisions=function(t,e){for(var r=0,o=0,a=n(n([],t,!0),e,!0);o<a.length;o++){var u=a[o];if(u in this.brain)return this.brain[u].map((function(t){var e=(0,i.mapxy)(t.x,t.y,r%4,r<4?"rotation":"mirror");return{x:e[0],y:e[1],fitness:t.fitness}}));r++}return[]},t.prototype.decide=function(t,e){var r=this.mappedDecisions(t,e);return r.length?r[Math.floor(Math.random()*r.length)]:(this.createMoves(t[0]),this.decide(t,e))},t.prototype.createMoves=function(t){this.brain[t]=[];var e=this.brain[t],r=t.replace(/[10]/g,"    ");if(r.includes("null"))do{var n=r.lastIndexOf("null")/4;e.push({x:Math.floor(n/3),y:n%3,fitness:100}),r=r.replace(/null( *)$/,"    $1")}while(r.includes("null"))},t}();e.default=o}},e={};!function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,r),o.exports}(243)})();